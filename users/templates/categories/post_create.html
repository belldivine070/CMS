{% extends "layout.html" %}
{% load static %}
{% load widget_tweaks %}
{% load category_tags %}



{% block content %}
<div class="container-fluid mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>✍️ Create New Post</h2>
        <a href="{% url 'users:post_list_by_category' category_slug=category.slug %}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Back to Posts
        </a>
    </div>


    {# Define fields that will be explicitly rendered in the right column, so they don't appear on the left #}
    {% with EXCLUDED_FIELDS="title,slug,category,body,media_file,publish_now" %}
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="row">
            {# ---------------------------------------------------------- #}
            {# RIGHT COLUMN — CATEGORY, PUBLISH, MEDIA, SAVE/DELETE #}
            {# ---------------------------------------------------------- #}
            <div class="col-lg-4 order-lg-2 order-1">
                <div class="card shadow mb-4">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-success">
                           Post Options
                        </h6>
                    </div>

                    <div class="card-body">
                
                        {# GALLERY IMAGES UPLOAD #}
                        {% if form.image %}
                            <div class="mb-3">
                                <div class="form-group mb-3">
                                    <label>Upload Images</label>
                                    <input type="file" accept="image/*" name="image" multiple class="form-control">
                                </div>
                            </div>
                        {% endif %}

                        <hr>

                        {# PUBLISH OPTIONS #}
                        {% if form.is_published %}
                            <div class="mb-3">
                                <div class="form-check"> <input type="checkbox" name="is_published" id="id_is_published"> Publish Now </div>
                            </div>
                        {% endif %}
                    
                   
                        <div class="d-flex gap-2 mt-4">
                            <button type="submit" class="btn btn-success flex-fill">
                                <i class="bi bi-plus-circle"></i> Create Post
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            {# ---------------------------------------------- #}
            {# LEFT COLUMN — TITLE, SLUG, BODY, AND OTHER FIELDS #}
            {# ---------------------------------------------- #}
            <div class="col-lg-8 order-lg-1 order-2">
                <div class="card shadow mb-4">
                    <div class="card-header py-3">
                        <h3 class="card-title mb-3">{{ category}} Content</h3>
                    </div>
 
                    {% if form.errors %}
                    <div class="alert alert-danger">
                        <strong>Please fix the following errors:</strong>
                        <ul>
                            {% for field, errors in form.errors.items %}
                                {% for error in errors %}
                                    <li>{{ field }}: {{ error }}</li>
                                {% endfor %}
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                    
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label fw-bold">{{ form.title.label }}</label>
                            {% render_field form.title class="form-control" placeholder="Title" %}
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">{{ form.slug.label }}</label>
                            {% render_field form.slug class="form-control" placeholder="Slug" %}
                            <small class="text-muted">Auto-generated if blank.</small>
                        </div>          
                            
                        {% if form.excerpt %}
                        <div class="mb-3">
                            <label class="form-label fw-bold">{{ form.excerpt.label }}</label>
                            {% render_field form.excerpt class="form-control" placeholder="Excerpt" %}
                        </div>
                        {% endif %}
                        
                        {% if form.content %}
                            <div class="mb-3">
                                <label class="form-label fw-bold">{{ form.content.label }}</label>
                                {% render_field form.content class="form-control" id="summernote" placeholder="Lets write our post content here..." %}
                            </div>
                        {% endif %}
                        
                        {% if form.btn_text %}
                            <div class="mb-3">
                                <label class="form-label fw-bold">{{ form.btn_text.label }}</label>
                                {% render_field form.btn_text class="form-control" placeholder="Read More" %}
                            </div>
                        {% endif %}    
                        
                        {% if form.video %}
                            <div class="mb-3">
                                <label class="form-label fw-bold">{{ form.video.label }}</label>
                                {% render_field form.video class="form-control" %}  
                            </div>
                        {% endif %} 
                        
                        {% if form.audio %}
                            <div class="mb-3">
                                <label class="form-label fw-bold">{{ form.audio.label }}</label>
                                {% render_field form.audio  class="form-control" %}
                            </div>
                        {% endif %}    
                        
                        {% if form.icon %}
                            <div class="mb-3">
                                <label class="form-label fw-bold">{{ form.icon.label }}</label>
                                {% render_field form.icon class="form-control" %}
                            </div>
                        {% endif %}    
                            
                        {% if form.image_align %}
                        <label for="form-label fw-bold">{{ form.image_align.label }}</label>
                            <div class="mb-3">
                                <select name="image_align" class="form-select" id="id_image_align">
                                    <option value="" selected>---------</option>
                                    <option value="left">Left</option>
                                    <option value="center">Center</option>
                                    <option value="right">Right</option>
                                </select>
                            </div>
                        {% endif %}
                            
                        {% if form.tags %}
                        <div class="mb-3">
                            <label class="form-label fw-bold">{{ form.tags.label }}</label>
                            {% render_field form.tags class="form-control" %}   
                        </div>
                        {% endif %}
                            
                        {% if form.event_date %}
                        <div class="mb-3">
                            <label class="form-label fw-bold">{{ form.event_date.label }}</label>
                            {% render_field form.event_date class="form-control" %}
                        </div>
                        {% endif %}   
                       
                        {% if form.address %}
                        <div class="mb-3">
                            <label class="form-label fw-bold">{{ form.address.label }}</label>
                            {% render_field form.address class="form-control" placeholder="Address" %}
                        </div>
                        {% endif %}
                        
                        {% if form.addfield1 %}
                        <div class="mb-3">
                            <label class="form-label fw-bold">{{ form.addfield1.label }}</label>
                            {% render_field form.addfield1 class="form-control" placeholder="Add Field 1" %}
                        </div>
                        {% endif %}

                        {% if form.addfield2 %}
                        <div class="mb-3">
                            <label class="form-label fw-bold">{{ form.addfield2.label }}</label>
                            {% render_field form.addfield2 class="form-control" placeholder="Add Field 2" %}
                        </div>
                        {% endif %}

                        {% if form.addfield3 %}
                        <div class="mb-3">
                            <label class="form-label fw-bold">{{ form.addfield3.label }}</label>
                            {% render_field form.addfield3 class="form-control" placeholder="Add Field 3" %}
                        </div>
                        {% endif %}

                        {% if form.addfield4 %}
                        <div class="mb-3">
                            <label class="form-label fw-bold">{{ form.addfield4.label }}</label>
                            {% render_field form.addfield4 class="form-control" placeholder="Add Field 4" %}
                        </div>
                        {% endif %}

                        {% if form.addfield4 %}
                        <div class="mb-3">
                            <label class="form-label fw-bold">{{ form.addfield4.label }}</label>
                            {% render_field form.addfield4 class="form-control" placeholder="Add Field 4" %}
                        </div>
                        {% endif %}

                        {% if form.subtitle %}
                        <div class="mb-3">
                            <label class="form-label fw-bold">{{ form.subtitle.label }}</label>
                            {% render_field form.subtitle class="form-control" placeholder="Add Subtitle" %}
                        </div>
                        {% endif %}
                            
                        {% if form.shortcodes1 %}
                        <div class="mb-3">
                            <label class="form-label fw-bold">{{form.shortcodes1.label}}</label>
                            {% render_field form.shortcodes1 class="form-control" placeholder="Shortcodes1" %}
                        </div>
                        {% endif %}    

                        {% if form.shortcodes2 %}
                        <div class="mb-3">
                            <label class="form-label fw-bold">{{form.shortcodes2.label}}</label>
                            {% render_field form.shortcodes2 class="form-control" placeholder="Shortcodes2" %}
                        </div>
                        {% endif %}    
                            
                        {% if form.progress %}
                            <div class="mb-3">
                                <label class="form-label fw-bold">{{ form.progress.label }}</label>
                                {% render_field form.progress class="form-control" placeholder="Progress" %}
                            </div>
                        {% endif %}

                        {% comment %} {% for field in form.visible_fields %}
                            {% if field.name not in EXCLUDED_FIELDS|split:"," %}
                            <div class="mb-3">
                                <label class="form-label fw-bold">{{ field.label }}</label>
                                {% render_field field class="form-control" %}
                            </div>
                            {% endif %}
                        {% endfor %}  {% endcomment %}
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
{% endwith %}
{% endblock content %}

